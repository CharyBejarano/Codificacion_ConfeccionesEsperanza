
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultar Cliente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stilos.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stilosCliente.css') }}">
    <style>
        .search-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .search-methods {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .search-method {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }
        
        .search-method h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #495057;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn.volver {
            background: #6c757d;
            margin-top: 20px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn.volver:hover {
            background: #545b62;
        }
        
        .employee-details {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .employee-details h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .detail-item strong {
            color: #495057;
        }
        
        .alert {
            padding: 12px 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .search-divider {
            text-align: center;
            margin: 20px 0;
            color: #6c757d;
            font-weight: 500;
        }
    </style> 
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <a href="perfil.html" class="profile">
                <img src="{{ url_for('static', filename='img/iconousuario.png') }}" alt="Perfil" class="profile-icon">
                <span>Perfil</span>
            </a>
            
            <a href="{{ url_for('empleados.mostrar_empleados') }}" class="menu-item">
                <img src="{{ url_for('static', filename='img/iconoemple.png') }}" alt="Empleados" class="icon">
                <span>Usuarios</span> 
            </a>
            
            <a href="{{ url_for('empleados.mostrar_empleados') }}" class="menu-item"> 
                <img src="{{ url_for('static', filename='img/iconoprovee.png') }}" alt="Proveedores" class="icon">
                <span>Tareas</span> 
            </a>
            
            <a href="{{ url_for('clientes.mostrar_clientes') }}" class="menu-item">
                <img src="{{ url_for('static', filename='img/iconocliente.png') }}" alt="Clientes" class="icon">
                <span>Clientes</span>
            </a>
            
            <a href="{{ url_for('empleados.mostrar_empleados') }}" class="menu-item"> 
                <img src="{{ url_for('static', filename='img/iconoconfi.png') }}" alt="Configuración" class="icon">
                <span>Configuración</span>
            </a>
        </div>
        
        <div class="main-content">
            <nav class="top-nav">
                <div class="nav-links">
                    <a href="{{ url_for('home.mostar_home') }}" class="nav-link">Inicio</a>
                    <a href="{{ url_for('pedidos.mostrar_pedidos') }}" class="nav-link">Pedidos</a>
                    <a href="{{ url_for('material.mostrar_material') }}" class="nav-link">Material</a>
                    <a href="{{ url_for('empleados.mostrar_empleados') }}" class="nav-link">Balance General</a>
                </div>
                <div class="logout">
                    <a href="login.html"> 
                        <img src="{{ url_for('static', filename='img/iconosalida.png') }}" alt="Logout" class="logout-icon">
                    </a>   
                </div>
            </nav>
           
            <div class="content">
            <h1>Consultar Cliente</h1>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert {{ 'success' if category == 'success' else 'error' }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {% if mensaje %}
                <div class="alert {{ 'success' if 'encontrado exitosamente' in mensaje else 'info' if 'No se encontró' in mensaje else 'error' }}">
                    {{ mensaje }}
                </div>
            {% endif %}
            
            <div class="search-container">
                <form method="POST" id="searchForm"> {# Asegúrate de que el formulario tiene este ID #}
                    <input type="hidden" name="search_action" id="searchAction" value=""> {# Este campo oculto ya lo tienes #}
                    <div class="search-methods">
                        <div class="search-method">
                            <h3>🔍 Seleccionar de la Lista</h3>
                            <div class="form-group">
                                <label for="nit_cliente">Cliente:</label>
                                <select name="nit_cliente" id="nit_cliente">
                                    <option value="">-- Selecciona un cliente --</option>
                                    {% for cliente in clientes %} 
                                        <option value="{{ cliente.NIT }}"
                                            {% if cliente_encontrado and cliente.NIT == cliente_encontrado.NIT %}selected{% endif %}>
                                            {{ cliente.NIT }} - {{ cliente.nombre_cliente }}  
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="search-method">
                            <h3>🔎 Buscar por Criterio</h3>
                            <div class="form-group">
                                <label for="criterio_busqueda">Buscar por:</label>
                                <select name="criterio_busqueda" id="criterio_busqueda">
                                    <option value="">-- Selecciona criterio --</option>
                                    <option value="nit">NIT (Razón Social)</option>
                                    <option value="nombre">Nombre de Contacto</option>
                                    <option value="email">Email de Contacto</option>
                                    <option value="num_identificacion">Número de Identificación (Persona)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="valor_busqueda">Valor a buscar:</label>
                                <input type="text" name="valor_busqueda" id="valor_busqueda" 
                                        placeholder="Ingresa el valor a buscar...">
                            </div>
                            <div class="form-group" id="tipo_doc_group" style="display: none;">
                                <label for="tipo_documento_busqueda">Tipo de Documento:</label>
                                <select name="tipo_documento_busqueda" id="tipo_documento_busqueda">
                                    <option value="">-- Selecciona Tipo --</option>
                                    <option value="CC">Cédula de Ciudadanía</option>
                                    <option value="NIT">NIT</option>
                                    <option value="CE">Cédula de Extranjería</option>
                                    <option value="TI">Tarjeta de Identidad</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="search-divider">
                        <button type="submit" class="btn" id="searchButton">🔍 Buscar Cliente</button> {# AÑADIDO ID AQUÍ #}
                    </div>
                </form>
            </div>
            
            {% if cliente_encontrado %}
                <div class="client-details">
                    <h3>📋 Detalles del Cliente</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <strong>NIT (Razón Social):</strong><br>
                            {{ cliente_encontrado.NIT }}
                        </div>
                        <div class="detail-item">
                            <strong>Dirección Cliente:</strong><br>
                            {{ cliente_encontrado.cliente_direccion if cliente_encontrado.cliente_direccion else 'No especificada' }}
                        </div>
                        <div class="detail-item">
                            <strong>Nombre de Contacto:</strong><br>
                            {{ cliente_encontrado.Nombre }}
                        </div>
                        <div class="detail-item">
                            <strong>Apellido de Contacto:</strong><br>
                            {{ cliente_encontrado.Apellido if cliente_encontrado.Apellido else 'N/A' }}
                        </div>
                        <div class="detail-item">
                            <strong>Email de Contacto:</strong><br>
                            {{ cliente_encontrado.Correo }}
                        </div>
                        <div class="detail-item">
                            <strong>Teléfono de Contacto:</strong><br>
                            {{ cliente_encontrado.Telefono if cliente_encontrado.Telefono else 'No especificado' }}
                        </div>
                        <div class="detail-item">
                            <strong>N° Identificación Persona:</strong><br>
                            {{ cliente_encontrado.num_identificacion }}
                        </div>
                        <div class="detail-item">
                            <strong>Tipo Documento Persona:</strong><br>
                            {{ cliente_encontrado.tipoDocumento_tipo_Doc }}
                        </div>
                    </div>
                    <div class="btn-group">
                        <a href="{{ url_for('clientes.editar_cliente', num_identificacion=cliente_encontrado.num_identificacion, tipo_documento=cliente_encontrado.tipoDocumento_tipo_Doc) }}" class="btn">
                            Editar Cliente
                        </a>
                        <form action="{{ url_for('clientes.eliminar_cliente') }}" method="POST" style="display:inline;" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este cliente y la persona asociada? Esta acción no se puede deshacer.');">
                            <input type="hidden" name="num_identificacion" value="{{ cliente_encontrado.num_identificacion }}">
                            <input type="hidden" name="tipo_documento" value="{{ cliente_encontrado.tipoDocumento_tipo_Doc }}">
                            <button type="submit" class="btn" style="background-color: #dc3545;">Eliminar Cliente</button>
                        </form>
                    </div>
                </div>
            {% endif %}
            
            <div class="volver-btn">
                <a href="{{ url_for('home.mostar_home') }}" class="btn volver">Volver al Inicio</a>
            </div>
        </div>
    </div>
</div>

<script>
    // Envuelve todo el código JavaScript en un evento DOMContentLoaded
    // Esto asegura que el script se ejecute solo después de que todo el HTML haya sido cargado y parseado.
    document.addEventListener('DOMContentLoaded', function() {
        const nitClienteSelect = document.getElementById('nit_cliente');
        const criterioBusquedaSelect = document.getElementById('criterio_busqueda');
        const valorBusquedaInput = document.getElementById('valor_busqueda');
        const tipoDocGroup = document.getElementById('tipo_doc_group');
        const tipoDocumentoBusquedaSelect = document.getElementById('tipo_documento_busqueda');
        const searchActionInput = document.getElementById('searchAction'); // Campo oculto: search_action
        const searchButton = document.getElementById('searchButton');     // El botón de búsqueda

        // --- INICIO DE LÍNEAS DE DEPURACIÓN EN JAVASCRIPT ---
        console.log('--- Depuración de JavaScript (DOMContentLoaded) ---');
        console.log('nitClienteSelect:', nitClienteSelect);
        console.log('criterioBusquedaSelect:', criterioBusquedaSelect);
        console.log('valorBusquedaInput:', valorBusquedaInput);
        console.log('tipoDocGroup:', tipoDocGroup);
        console.log('tipoDocumentoBusquedaSelect:', tipoDocumentoBusquedaSelect);
        console.log('searchActionInput:', searchActionInput);
        console.log('searchButton:', searchButton);
        console.log('--------------------------------------------------');
        // --- FIN DE LÍNEAS DE DEPURACIÓN EN JAVASCRIPT ---

        // Función para limpiar los campos de búsqueda por criterio
        function clearCriterionSearch() {
            if (criterioBusquedaSelect) criterioBusquedaSelect.value = '';
            if (valorBusquedaInput) valorBusquedaInput.value = '';
            if (tipoDocGroup) tipoDocGroup.style.display = 'none';
            if (tipoDocumentoBusquedaSelect) tipoDocumentoBusquedaSelect.value = '';
        }

        // Función para limpiar la selección de la lista
        function clearListSelection() {
            if (nitClienteSelect) nitClienteSelect.value = '';
        }

        // Listener para el dropdown de selección por lista
        if (nitClienteSelect) {
            nitClienteSelect.addEventListener('change', function() {
                if (this.value) { // Si se selecciona un cliente (valor no vacío)
                    clearCriterionSearch(); // Limpiar los campos del otro método de búsqueda
                }
            });
        }

        // Listener para el dropdown de criterio de búsqueda
        if (criterioBusquedaSelect) {
            criterioBusquedaSelect.addEventListener('change', function() {
                if (this.value) { // Si se selecciona un criterio (valor no vacío)
                    clearListSelection(); // Limpiar la selección de la lista
                }
                // Mostrar u ocultar el campo de tipo de documento según el criterio
                if (this.value === 'num_identificacion') {
                    if (tipoDocGroup) tipoDocGroup.style.display = 'block';
                } else {
                    if (tipoDocGroup) tipoDocGroup.style.display = 'none';
                    if (tipoDocumentoBusquedaSelect) tipoDocumentoBusquedaSelect.value = ''; // Limpiar si se oculta
                }
            });
        }

        // Listener para el campo de valor de búsqueda por criterio
        if (valorBusquedaInput) {
            valorBusquedaInput.addEventListener('input', function() {
                if (this.value) { // Si se empieza a escribir un valor
                    clearListSelection(); // Limpiar la selección de la lista
                }
            });
        }

        // Listener para el clic en el botón de búsqueda
        // Esto asegura que search_action se establezca justo antes de enviar el formulario
        // Solo se añade el listener si el botón existe (searchButton no es null)
        if (searchButton) {
            searchButton.addEventListener('click', function(event) {
                // Determinar qué método de búsqueda el usuario pretendía usar
                if (nitClienteSelect && nitClienteSelect.value) { // Verificar que el elemento exista y tenga valor
                    searchActionInput.value = 'search_by_list';
                    clearCriterionSearch(); 
                } else if (criterioBusquedaSelect && criterioBusquedaSelect.value && valorBusquedaInput && valorBusquedaInput.value) { // Verificar que los elementos existan y tengan valor
                    searchActionInput.value = 'search_by_criterion';
                    clearListSelection(); 
                } else {
                    searchActionInput.value = ''; 
                }
            });
        } else {
            console.error("Error: El botón con ID 'searchButton' no fue encontrado en el DOM.");
        }
    });
</script>

</body>
</html>